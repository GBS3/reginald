<Window x:Name="searchWindow"
        x:Class="Reginald.Views.SearchView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Reginald.Views"
        mc:Ignorable="d"
        
        xmlns:cal="http://www.caliburnproject.org"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                  
        xmlns:fw="clr-namespace:SourceChord.FluentWPF;assembly=FluentWPF"
        fw:AcrylicWindow.Enabled="True"
        fw:AcrylicWindow.NoiseOpacity="0"
        fw:AcrylicWindow.AcrylicWindowStyle="None"
                  
        Title="Search"
        Height="75" MinHeight="75"
        Width="650"
        FontFamily="Segoe UI"
        ResizeMode="NoResize"
        SizeToContent="Height"
        BorderBrush="#7d4500"
        
        WindowStartupLocation="Manual"
        WindowStyle="None"
        Topmost="True"
        ShowInTaskbar="False">
    <Window.Resources>
        <ResourceDictionary>
            <DataTemplate x:Key="searchResultsTemplate">
                <Grid Width="{Binding ElementName=searchWindow, Path=Width}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Image Source="{Binding Icon}"
                           Width="30" Height="30"
                           Margin="0 0 12.5 0"
                           Grid.Column="0"/>
                    <StackPanel VerticalAlignment="Center"
                                Margin="0 0 0 5"
                                Grid.Column="1" Grid.ColumnSpan="2">
                        <TextBlock Text="{Binding Description}" TextTrimming="CharacterEllipsis"
                                   Background="Transparent" Foreground="White"
                                   FontSize="24" FontWeight="Light"
                                   Margin="0" Padding="0"/>
                        <TextBlock Text="{Binding Alt}"
                                   Background="Transparent" Foreground="Gray"
                                   FontSize="12" FontWeight="Light"
                                   Margin="0" Padding="0"/>
                    </StackPanel>
                    <TextBlock Text="{Binding Count}"
                               Background="Transparent" Foreground="Gray"
                               FontSize="12" FontWeight="Light"
                               VerticalAlignment="Center" HorizontalAlignment="Right"
                               Grid.Column="3"
                               Margin="5 0 0 0" Padding="0 0 30 0"/>
                </Grid>
            </DataTemplate>

            <!-- ControlTemplate for ListBoxItems-->
            <ControlTemplate x:Key="SearchResultsListBoxItems" TargetType="ListBoxItem">
                <Border x:Name="listBoxItemBorder"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Padding="{TemplateBinding Padding}"
                            SnapsToDevicePixels="True">
                    <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                      SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                      Content="{TemplateBinding ContentControl.Content}"
                                      ContentTemplate="{TemplateBinding ContentControl.ContentTemplate}"/>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter TargetName="listBoxItemBorder"
                                Property="Background" Value="Transparent"/>
                    </Trigger>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter TargetName="listBoxItemBorder"
                                Property="Background" Value="#33d16c00"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <StackPanel>
            <TextBox x:Name="UserInput"
                     Background="Transparent" Foreground="White"
                     CaretBrush="Gray"
                     BorderThickness="0"
                     FontSize="32" FontWeight="Light"
                     Padding="10 0"
                     VerticalContentAlignment="Center"
                     Height="{Binding ElementName=searchWindow, Path=MinHeight}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="TextChanged">
                        <cal:ActionMessage MethodName="UserInput_TextChanged">
                            <cal:Parameter Value="{Binding ElementName=SearchResults}"/>
                            <cal:Parameter Value="$eventargs"/>
                        </cal:ActionMessage>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="PreviewKeyDown">
                        <cal:ActionMessage MethodName="UserInput_PreviewKeyDown">
                            <cal:Parameter Value="{Binding ElementName=SearchResults}"/>
                            <cal:Parameter Value="$eventargs"/>
                        </cal:ActionMessage>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </TextBox>

            <ListBox x:Name="SearchResults"
                     ItemTemplate="{StaticResource searchResultsTemplate}"
                     SelectedItem="{Binding Path=SelectedSearchResult, Mode=TwoWay}"
                     Background="Transparent"
                     MaxHeight="330"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     ScrollViewer.CanContentScroll="False"
                     BorderThickness="0">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                        <cal:ActionMessage MethodName="SearchResults_PreviewMouseLeftButtonDown">
                            <cal:Parameter Value="{Binding ElementName=SearchResults}"/>
                            <cal:Parameter Value="$eventargs"/>
                        </cal:ActionMessage>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="MouseLeave">
                        <cal:ActionMessage MethodName="SearchResults_MouseLeave">
                            <cal:Parameter Value="{Binding ElementName=SearchResults}"/>
                            <cal:Parameter Value="$eventargs"/>
                        </cal:ActionMessage>
                    </i:EventTrigger>
                    <i:EventTrigger EventName="SelectionChanged">
                        <cal:ActionMessage MethodName="SearchResults_SelectionChanged">
                            <cal:Parameter Value="{Binding ElementName=SearchResults}"/>
                            <cal:Parameter Value="$eventargs"/>
                        </cal:ActionMessage>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="IsSelected" Value="True"/>
                            </Trigger>
                        </Style.Triggers>
                        <Setter Property="Padding" Value="10 0"/>
                        <Setter Property="Height" Value="55"/>
                        <Setter Property="Template" Value="{StaticResource SearchResultsListBoxItems}"/>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </StackPanel>
    </Grid>
</Window>